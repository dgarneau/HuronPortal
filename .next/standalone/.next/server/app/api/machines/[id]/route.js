"use strict";(()=>{var e={};e.id=658,e.ids=[658],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},9714:e=>{e.exports=require("constants")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},8849:e=>{e.exports=require("node:http")},2286:e=>{e.exports=require("node:https")},612:e=>{e.exports=require("node:os")},7742:e=>{e.exports=require("node:process")},4492:e=>{e.exports=require("node:stream")},7261:e=>{e.exports=require("node:util")},5628:e=>{e.exports=require("node:zlib")},1131:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>R,patchFetch:()=>y,requestAsyncStorage:()=>O,routeModule:()=>h,serverHooks:()=>N,staticGenerationAsyncStorage:()=>v});var n={};t.r(n),t.d(n,{DELETE:()=>f,GET:()=>p,PUT:()=>x});var a=t(9303),i=t(8716),s=t(670),o=t(7070),u=t(1375),c=t(7956),l=t(1047),m=t(9276),d=t(5371);async function p(e,{params:r}){try{if(!await (0,u.Gg)())return o.NextResponse.json({error:"Non authentifi\xe9"},{status:401});let e=await (0,c.Lg)(r.id);if(!e)return o.NextResponse.json({error:"Machine non trouv\xe9e"},{status:404});return o.NextResponse.json({data:e})}catch(e){return(0,m.S3)(e)}}async function x(e,{params:r}){try{let t=await (0,u.Gg)();if(!t)return o.NextResponse.json({error:"Non authentifi\xe9"},{status:401});if(!(0,d.Od)(t.role))return o.NextResponse.json({error:"Permission refus\xe9e"},{status:403});let n=await e.json(),a=l.g.safeParse(n);if(!a.success)return(0,m.S3)(a.error);let i=await (0,c.Oq)(r.id,a.data);return o.NextResponse.json({data:i,message:"Machine modifi\xe9e avec succ\xe8s"})}catch(e){if(e instanceof Error&&"Machine not found"===e.message)return o.NextResponse.json({error:"Machine non trouv\xe9e"},{status:404});if(e instanceof Error&&"Client not found"===e.message)return o.NextResponse.json({error:"Client non trouv\xe9"},{status:404});return(0,m.S3)(e)}}async function f(e,{params:r}){try{let e=await (0,u.Gg)();if(!e)return o.NextResponse.json({error:"Non authentifi\xe9"},{status:401});if(!(0,d.GJ)(e))return o.NextResponse.json({error:"Permission refus\xe9e - Admin requis"},{status:403});return await (0,c.XV)(r.id),o.NextResponse.json({message:"Machine supprim\xe9e avec succ\xe8s"})}catch(e){return(0,m.S3)(e)}}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/machines/[id]/route",pathname:"/api/machines/[id]",filename:"route",bundlePath:"app/api/machines/[id]/route"},resolvedPagePath:"C:\\GIT\\HuronPortal\\app\\api\\machines\\[id]\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:O,staticGenerationAsyncStorage:v,serverHooks:N}=h,R="/api/machines/[id]/route";function y(){return(0,s.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:v})}},5371:(e,r,t)=>{function n(e){return e?.role==="Admin"}function a(e){return"Admin"===e||"Contr\xf4leur"===e}t.d(r,{GJ:()=>n,Od:()=>a})},1375:(e,r,t)=>{t.d(r,{Gg:()=>d,Rf:()=>x,Uj:()=>p,ed:()=>c,v6:()=>m});var n=t(6890),a=t(1463),i=t(1615);let s=new TextEncoder().encode(process.env.SESSION_SECRET||"development-secret-key-change-in-production"),o=Number(process.env.SESSION_DURATION)||3600,u="session";async function c(e,r,t){let a=Math.floor(Date.now()/1e3),i=a+o;return await new n.N({userId:e,username:r,role:t,createdAt:a,expiresAt:i}).setProtectedHeader({alg:"HS256"}).setIssuedAt(a).setExpirationTime(i).sign(s)}async function l(e){try{let{payload:r}=await (0,a._)(e,s),t=Math.floor(Date.now()/1e3);if(r.expiresAt&&"number"==typeof r.expiresAt&&r.expiresAt<t)return null;return r}catch(e){return null}}async function m(e){let r=e.cookies.get(u)?.value;return r?l(r):null}async function d(){let e=await (0,i.cookies)(),r=e.get(u)?.value;return r?l(r):null}function p(e){return{name:u,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:o,path:"/"}}function x(){return{name:u,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},25:(e,r,t)=>{t.d(r,{IK:()=>l,ZO:()=>c});var n=t(8657);let a=null,i=process.env.COSMOS_DATABASE||"huronportal-db",s=null;async function o(){let e=function(){if(!a){let e=process.env.COSMOS_ENDPOINT,r=process.env.COSMOS_KEY;if(!e||!r)throw console.error("Cosmos DB configuration error:"),console.error("COSMOS_ENDPOINT:",e?"set":"missing"),console.error("COSMOS_KEY:",r?"set":"missing"),Error("COSMOS_ENDPOINT and COSMOS_KEY must be defined in environment variables");console.log("Initializing Cosmos DB client with endpoint:",e),a=new n.Pi({endpoint:e,key:r})}return a}();if(!s){let{database:r}=await e.databases.createIfNotExists({id:i});s=r}return s}let u={users:null,machines:null,clients:null};async function c(e){if(!u[e]){let r=await o(),{container:t}=await r.containers.createIfNotExists({id:e,partitionKey:{paths:[{users:"/username",machines:"/id",clients:"/id"}[e]]}});u[e]=t}return u[e]}function l(e){if(409===e.code)throw Error("DUPLICATE_ENTRY");if(404===e.code)throw Error("NOT_FOUND");if(412===e.code)throw Error("CONCURRENT_MODIFICATION");throw e}},5290:(e,r,t)=>{t.d(r,{EI:()=>m,Nu:()=>c,Qu:()=>u,eI:()=>s,mz:()=>o,pN:()=>l});var n=t(8547),a=t(25);let i="clients";async function s(e){let r=await (0,a.ZO)(i),t={id:(0,n.Z)(),companyName:e.companyName,address:e.address,province:e.province,postalCode:e.postalCode,machineCount:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{resource:s}=await r.items.create(t);return s}async function o(e){let r=await (0,a.ZO)(i);try{let{resource:t}=await r.item(e,e).read();return t||null}catch(e){if(404===e.code)return null;throw e}}async function u(e,r){let t=await (0,a.ZO)(i),{resource:n}=await t.item(e,e).read();if(!n)throw Error("Client not found");let s={...n,...r,updatedAt:new Date().toISOString()},{resource:o}=await t.item(e,e).replace(s);return o}async function c(e){let r=await (0,a.ZO)(i);await r.item(e,e).delete()}async function l(e=50,r){let t=(await (0,a.ZO)(i)).items.query("SELECT * FROM c ORDER BY c.companyName ASC",{maxItemCount:e,continuationToken:r}),{resources:n,continuationToken:s}=await t.fetchNext();return{clients:n,continuationToken:s}}async function m(e,r=50){let t=await (0,a.ZO)(i),n={query:"SELECT * FROM c WHERE CONTAINS(LOWER(c.companyName), @searchTerm) ORDER BY c.companyName ASC",parameters:[{name:"@searchTerm",value:e.toLowerCase()}]},{resources:s}=await t.items.query(n,{maxItemCount:r}).fetchAll();return s}},7956:(e,r,t)=>{t.d(r,{C8:()=>o,Lg:()=>u,Oq:()=>l,UF:()=>d,XV:()=>m,xw:()=>c});var n=t(8547),a=t(25),i=t(5290);let s="machines";async function o(e,r){let t=await (0,a.ZO)(s),o=await (0,i.mz)(e.clientId);if(!o)throw Error("Client not found");let u={id:(0,n.Z)(),numeroOL:e.numeroOL,type:e.type,clientId:e.clientId,clientName:o.companyName,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),createdBy:r},{resource:c}=await t.items.create(u);return await (0,i.Qu)(e.clientId,{}),c}async function u(e){let r=await (0,a.ZO)(s);try{let{resource:t}=await r.item(e,e).read();return t||null}catch(e){if(404===e.code)return null;throw e}}async function c(e){let r=await (0,a.ZO)(s),{resources:t}=await r.items.query({query:"SELECT * FROM c WHERE c.numeroOL = @numeroOL",parameters:[{name:"@numeroOL",value:e}]}).fetchAll();return t.length>0?t[0]:null}async function l(e,r){let t=await (0,a.ZO)(s),{resource:n}=await t.item(e,e).read();if(!n)throw Error("Machine not found");let o=n.clientName;if(r.clientId&&r.clientId!==n.clientId){let e=await (0,i.mz)(r.clientId);if(!e)throw Error("Client not found");o=e.companyName}let u={...n,...r,clientName:o,updatedAt:new Date().toISOString()},{resource:c}=await t.item(e,e).replace(u);return c}async function m(e){let r=await (0,a.ZO)(s);await r.item(e,e).delete()}async function d(e=50,r,t){let n=await (0,a.ZO)(s),i="SELECT * FROM c",o=[],u=[];t?.clientId&&(u.push("c.clientId = @clientId"),o.push({name:"@clientId",value:t.clientId})),t?.numeroOL&&(u.push("CONTAINS(c.numeroOL, @numeroOL)"),o.push({name:"@numeroOL",value:t.numeroOL})),u.length>0&&(i+=" WHERE "+u.join(" AND ")),i+=" ORDER BY c.numeroOL ASC";let c=n.items.query({query:i,parameters:o},{maxItemCount:e,continuationToken:r}),{resources:l,continuationToken:m}=await c.fetchNext();return{machines:l,continuationToken:m}}},9276:(e,r,t)=>{t.d(r,{S3:()=>i,jl:()=>a});var n=t(6263);function a(e,r,t=400,n){return Response.json({error:e,code:r,details:n},{status:t})}function i(e){if(console.error("Error:",e),e instanceof n.jmq)return a("Donn\xe9es invalides","VALIDATION_ERROR",400,e.issues.map(e=>({field:e.path.join("."),message:e.message})));if(e instanceof Error)switch(e.message){case"DUPLICATE_ENTRY":return a("Un enregistrement avec ces informations existe d\xe9j\xe0","DUPLICATE_ENTRY",409);case"NOT_FOUND":return a("Ressource non trouv\xe9e","NOT_FOUND",404);case"CONCURRENT_MODIFICATION":return a("Cet enregistrement a \xe9t\xe9 modifi\xe9 par un autre utilisateur","CONCURRENT_MODIFICATION",412);case"UNAUTHORIZED":return a("Authentification requise","UNAUTHORIZED",401);case"FORBIDDEN":return a("Acc\xe8s interdit","FORBIDDEN",403)}return a("Une erreur est survenue","SERVER_ERROR",500)}},2038:(e,r,t)=>{t.d(r,{s:()=>n});let n={required:"Ce champ est requis",invalid:"Valeur invalide",minLength:e=>`Minimum ${e} caract\xe8res requis`,maxLength:e=>`Maximum ${e} caract\xe8res autoris\xe9s`,email:"Adresse courriel invalide",password:{required:"Le mot de passe est requis",minLength:"Le mot de passe doit contenir au moins 8 caract\xe8res",maxLength:"Le mot de passe ne peut pas d\xe9passer 128 caract\xe8res"},user:{usernameRequired:"Le nom d'utilisateur est requis",usernameMin:"Le nom d'utilisateur doit contenir au moins 3 caract\xe8res",usernameMax:"Le nom d'utilisateur ne peut pas d\xe9passer 50 caract\xe8res",usernameFormat:"Le nom d'utilisateur ne peut contenir que des lettres minuscules, chiffres, points, traits d'union et underscores",nameRequired:"Le nom complet est requis",nameMax:"Le nom ne peut pas d\xe9passer 100 caract\xe8res",emailRequired:"Le courriel est requis",emailInvalid:"Adresse courriel invalide",emailMax:"Le courriel ne peut pas d\xe9passer 100 caract\xe8res",roleRequired:"Le r\xf4le est requis",roleInvalid:"R\xf4le invalide. Choisir: Admin, Contr\xf4leur ou Utilisateur",duplicateUsername:e=>`Le nom d'utilisateur "${e}" est d\xe9j\xe0 utilis\xe9. Veuillez en choisir un autre.`,duplicateEmail:e=>`Le courriel "${e}" est d\xe9j\xe0 utilis\xe9. Veuillez en choisir un autre.`},machine:{numeroOLRequired:"Le num\xe9ro #OL est requis",numeroOLMax:"Le num\xe9ro #OL ne peut pas d\xe9passer 50 caract\xe8res",numeroOLFormat:"Le num\xe9ro #OL ne peut contenir que des lettres majuscules, chiffres et tirets",duplicateOL:e=>`Le num\xe9ro #OL "${e}" existe d\xe9j\xe0`,typeRequired:"Le type de machine est requis",typeMax:"Le type ne peut pas d\xe9passer 200 caract\xe8res",clientRequired:"Le client est requis",clientInvalid:"Client invalide"},client:{companyNameRequired:"Le nom de l'entreprise est requis",companyNameMax:"Le nom de l'entreprise ne peut pas d\xe9passer 200 caract\xe8res",addressRequired:"L'adresse est requise",addressMax:"L'adresse ne peut pas d\xe9passer 300 caract\xe8res",provinceRequired:"La province est requise",provinceInvalid:"Province invalide",postalCodeRequired:"Le code postal est requis",postalCodeFormat:"Format de code postal invalide (A1A 1A1 ou A1A1A1)",hasMatches:e=>`Ce client a ${e} machine(s) associ\xe9e(s). Veuillez d'abord supprimer ou r\xe9assigner les machines.`},auth:{invalidCredentials:"Identifiants invalides",sessionExpired:"Votre session a expir\xe9. Veuillez vous reconnecter.",unauthorized:"Authentification requise",forbidden:"Acc\xe8s interdit",forbiddenRole:e=>`Vous n'avez pas les permissions n\xe9cessaires pour ${e}`},concurrency:{modified:"Cet enregistrement a \xe9t\xe9 modifi\xe9 par un autre utilisateur. Veuillez rafra\xeechir et r\xe9essayer.",machineModified:"Cette machine a \xe9t\xe9 modifi\xe9e par un autre utilisateur. Veuillez rafra\xeechir et r\xe9essayer.",clientModified:"Ce client a \xe9t\xe9 modifi\xe9 par un autre utilisateur. Veuillez rafra\xeechir et r\xe9essayer.",userModified:"Cet utilisateur a \xe9t\xe9 modifi\xe9 par un autre administrateur. Veuillez rafra\xeechir et r\xe9essayer."},deletion:{cannotDeleteSelf:"Vous ne pouvez pas supprimer votre propre compte utilisateur.",cannotDeleteLastAdmin:"Impossible de supprimer le dernier administrateur du syst\xe8me.",confirmDelete:"\xcates-vous s\xfbr de vouloir supprimer cet \xe9l\xe9ment?"},success:{created:e=>`${e} cr\xe9\xe9 avec succ\xe8s`,updated:e=>`${e} modifi\xe9 avec succ\xe8s`,deleted:e=>`${e} supprim\xe9 avec succ\xe8s`,loginSuccess:"Connexion r\xe9ussie",logoutSuccess:"D\xe9connexion r\xe9ussie"},server:{error:"Une erreur est survenue",unavailable:"Le service est temporairement indisponible"}}},1047:(e,r,t)=>{t.d(r,{J6:()=>i,Lf:()=>l,c5:()=>u,dm:()=>o,g:()=>c,gV:()=>s,rR:()=>m});var n=t(6263),a=t(2038);let i=n.Ryn({username:n.Z_8().min(3,a.s.user.usernameMin).max(50,a.s.user.usernameMax).regex(/^[a-z0-9._-]+$/,a.s.user.usernameFormat),email:n.Z_8().min(1,a.s.user.emailRequired).email(a.s.user.emailInvalid).max(100,a.s.user.emailMax),name:n.Z_8().min(1,a.s.user.nameRequired).max(100,a.s.user.nameMax),password:n.Z_8().min(8,a.s.password.minLength).max(128,a.s.password.maxLength),role:n.KmV(["Admin","Contr\xf4leur","Utilisateur"],{message:a.s.user.roleInvalid}),isActive:n.O72().default(!0)}),s=n.Ryn({username:n.Z_8().min(3,a.s.user.usernameMin).max(50,a.s.user.usernameMax).regex(/^[a-z0-9._-]+$/,a.s.user.usernameFormat).optional(),email:n.Z_8().email(a.s.user.emailInvalid).max(100,a.s.user.emailMax).optional(),name:n.Z_8().min(1,a.s.user.nameRequired).max(100,a.s.user.nameMax).optional(),password:n.Z_8().min(8,a.s.password.minLength).max(128,a.s.password.maxLength).optional(),role:n.KmV(["Admin","Contr\xf4leur","Utilisateur"],{message:a.s.user.roleInvalid}).optional(),isActive:n.O72().optional()}),o=n.Ryn({username:n.Z_8().min(1,"Le nom d'utilisateur ou courriel est requis"),password:n.Z_8().min(1,a.s.password.required)}),u=n.Ryn({numeroOL:n.Z_8().min(1,a.s.machine.numeroOLRequired).max(50,a.s.machine.numeroOLMax).regex(/^[A-Z0-9-]+$/,a.s.machine.numeroOLFormat),type:n.Z_8().min(1,a.s.machine.typeRequired).max(200,a.s.machine.typeMax),clientId:n.Z_8().uuid(a.s.machine.clientInvalid)}),c=n.Ryn({numeroOL:n.Z_8().min(1,a.s.machine.numeroOLRequired).max(50,a.s.machine.numeroOLMax).regex(/^[A-Z0-9-]+$/,a.s.machine.numeroOLFormat).optional(),type:n.Z_8().min(1,a.s.machine.typeRequired).max(200,a.s.machine.typeMax).optional(),clientId:n.Z_8().uuid(a.s.machine.clientInvalid).optional()}),l=n.Ryn({companyName:n.Z_8().min(1,a.s.client.companyNameRequired).max(200,a.s.client.companyNameMax),address:n.Z_8().min(1,a.s.client.addressRequired).max(300,a.s.client.addressMax),province:n.KmV(["QC","ON","AB","BC","MB","NB","NL","NT","NS","NU","PE","SK","YT"],{message:a.s.client.provinceInvalid}),postalCode:n.Z_8().regex(/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,a.s.client.postalCodeFormat).transform(e=>e.replace(/[ -]/g,"").toUpperCase())}),m=n.Ryn({companyName:n.Z_8().min(1,a.s.client.companyNameRequired).max(200,a.s.client.companyNameMax).optional(),address:n.Z_8().min(1,a.s.client.addressRequired).max(300,a.s.client.addressMax).optional(),province:n.KmV(["QC","ON","AB","BC","MB","NB","NL","NT","NS","NU","PE","SK","YT"],{message:a.s.client.provinceInvalid}).optional(),postalCode:n.Z_8().regex(/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,a.s.client.postalCodeFormat).transform(e=>e.replace(/[ -]/g,"").toUpperCase()).optional()})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[276,112,418,972,263],()=>t(1131));module.exports=n})();