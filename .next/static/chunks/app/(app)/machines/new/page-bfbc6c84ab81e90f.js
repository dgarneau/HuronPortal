(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[436,564],{2256:function(e,r,t){Promise.resolve().then(t.bind(t,3249))},3249:function(e,r,t){"use strict";t.d(r,{MachineForm:function(){return u}});var n=t(7437),a=t(9501),s=t(3590),i=t(9376),o=t(2265),c=t(914),l=t(8068),d=t(4226),m=t(4553);function u(e){var r,t;let{machine:u,mode:p}=e,x=(0,i.useRouter)(),[f,h]=(0,o.useState)(!1),[y,g]=(0,o.useState)(""),[b,N]=(0,o.useState)([]),[v,L]=(0,o.useState)(""),[Z,_]=(0,o.useState)(!1),{register:j,handleSubmit:C,formState:{errors:A},setValue:O,watch:w}=(0,a.cI)({resolver:(0,s.F)(c.c5),defaultValues:u?{numeroOL:u.numeroOL,type:u.type,clientId:u.clientId}:void 0}),I=w("clientId");async function E(){try{let e=await fetch("/api/clients?limit=100");if(e.ok){let r=await e.json();N(r.data||[])}}catch(e){console.error("Error fetching clients:",e)}}async function S(){try{_(!0);let e=await fetch("/api/clients?search=".concat(encodeURIComponent(v)));if(e.ok){let r=await e.json();N(r.data||[])}}catch(e){console.error("Error searching clients:",e)}finally{_(!1)}}(0,o.useEffect)(()=>{E()},[]),(0,o.useEffect)(()=>{v.length>=2?S():E()},[v]);let z=async e=>{h(!0),g("");try{let r="create"===p?"/api/machines":"/api/machines/".concat(null==u?void 0:u.id),t=await fetch(r,{method:"create"===p?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.error||"Une erreur est survenue")}x.push("/machines"),x.refresh()}catch(e){g(e instanceof Error?e.message:"Une erreur est survenue")}finally{h(!1)}},R=b.find(e=>e.id===I);return(0,n.jsxs)("form",{onSubmit:C(z),noValidate:!0,className:"space-y-6 max-w-2xl",children:[y&&(0,n.jsx)(m.B,{children:y}),(0,n.jsx)(l.I,{label:"Num\xe9ro OL",...j("numeroOL"),error:null===(r=A.numeroOL)||void 0===r?void 0:r.message,placeholder:"OL-12345",disabled:f}),(0,n.jsx)(l.I,{label:"Type de machine",...j("type"),error:null===(t=A.type)||void 0===t?void 0:t.message,placeholder:"CNC Lathe, CNC Mill, etc.",disabled:f}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-secondary-700 mb-1",children:"Client"}),(0,n.jsx)("input",{type:"text",placeholder:"Rechercher un client...",value:v,onChange:e=>L(e.target.value),className:"input-field mb-2",disabled:f}),(0,n.jsx)("select",{...j("clientId"),disabled:f,className:"input-field",size:8,children:b.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.companyName," - ",e.address]},e.id))}),A.clientId&&(0,n.jsx)("p",{className:"mt-1 text-sm text-error-600",children:A.clientId.message}),R&&(0,n.jsxs)("div",{className:"mt-2 p-3 bg-secondary-50 rounded border border-secondary-200",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-secondary-900",children:R.companyName}),(0,n.jsx)("p",{className:"text-sm text-secondary-600",children:R.address}),(0,n.jsxs)("p",{className:"text-sm text-secondary-600",children:[R.province," ",R.postalCode]})]})]}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)(d.z,{type:"submit",disabled:f,children:f?"Enregistrement...":"create"===p?"Cr\xe9er la machine":"Enregistrer"}),(0,n.jsx)(d.z,{type:"button",variant:"secondary",onClick:()=>x.push("/machines"),disabled:f,children:"Annuler"})]})]})}},4226:function(e,r,t){"use strict";t.d(r,{z:function(){return a}});var n=t(7437);t(2265);let a=e=>{let{variant:r="primary",size:t="md",isLoading:a=!1,children:s,className:i="",disabled:o,...c}=e;return(0,n.jsx)("button",{className:"".concat("font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-primary-600 hover:bg-primary-700 text-white focus:ring-primary-500 disabled:bg-primary-300",secondary:"bg-secondary-200 hover:bg-secondary-300 text-secondary-900 focus:ring-secondary-400 disabled:bg-secondary-100",danger:"bg-error-600 hover:bg-error-700 text-white focus:ring-error-500 disabled:bg-error-300"}[r]," ").concat({sm:"py-1 px-3 text-sm",md:"py-2 px-4 text-base",lg:"py-3 px-6 text-lg"}[t]," ").concat(i),disabled:o||a,...c,children:a?"Chargement...":s})}},4553:function(e,r,t){"use strict";t.d(r,{B:function(){return a}});var n=t(7437);t(2265);let a=e=>{let{children:r,className:t=""}=e;return r?(0,n.jsx)("div",{className:"bg-error-50 border border-error-200 text-error-700 px-4 py-3 rounded-md ".concat(t),role:"alert",children:(0,n.jsx)("p",{className:"text-sm",children:r})}):null}},8068:function(e,r,t){"use strict";t.d(r,{I:function(){return a}});var n=t(7437);let a=t(2265).forwardRef((e,r)=>{let{label:t,error:a,className:s="",id:i,...o}=e,c=i||"input-".concat(null==t?void 0:t.replace(/\s+/g,"-").toLowerCase());return(0,n.jsxs)("div",{className:"w-full",children:[t&&(0,n.jsx)("label",{htmlFor:c,className:"block text-sm font-medium text-secondary-700 mb-1",children:t}),(0,n.jsx)("input",{ref:r,id:c,className:"input-field ".concat(a?"border-error-500 focus:ring-error-500":""," ").concat(s),...o}),a&&(0,n.jsx)("p",{className:"mt-1 text-sm text-error-600",role:"alert",children:a})]})});a.displayName="Input"},914:function(e,r,t){"use strict";t.d(r,{Lf:function(){return I},dm:function(){return O},c5:function(){return w},J6:function(){return C},gV:function(){return A}});var n=t(7550);let a="Le mot de passe doit contenir au moins 8 caract\xe8res",s="Le mot de passe ne peut pas d\xe9passer 128 caract\xe8res",i="Le nom d'utilisateur doit contenir au moins 3 caract\xe8res",o="Le nom d'utilisateur ne peut pas d\xe9passer 50 caract\xe8res",c="Le nom d'utilisateur ne peut contenir que des lettres minuscules, chiffres, points, traits d'union et underscores",l="Le nom complet est requis",d="Le nom ne peut pas d\xe9passer 100 caract\xe8res",m="Adresse courriel invalide",u="Le courriel ne peut pas d\xe9passer 100 caract\xe8res",p="R\xf4le invalide. Choisir: Admin, Contr\xf4leur ou Utilisateur",x="Le num\xe9ro #OL est requis",f="Le num\xe9ro #OL ne peut pas d\xe9passer 50 caract\xe8res",h="Le num\xe9ro #OL ne peut contenir que des lettres majuscules, chiffres et tirets",y="Le type de machine est requis",g="Le type ne peut pas d\xe9passer 200 caract\xe8res",b="Client invalide",N="Le nom de l'entreprise est requis",v="Le nom de l'entreprise ne peut pas d\xe9passer 200 caract\xe8res",L="L'adresse est requise",Z="L'adresse ne peut pas d\xe9passer 300 caract\xe8res",_="Province invalide",j="Format de code postal invalide (A1A 1A1 ou A1A1A1)",C=n.Ryn({username:n.Z_8().min(3,i).max(50,o).regex(/^[a-z0-9._-]+$/,c),email:n.Z_8().min(1,"Le courriel est requis").email(m).max(100,u),name:n.Z_8().min(1,l).max(100,d),password:n.Z_8().min(8,a).max(128,s),role:n.KmV(["Admin","Contr\xf4leur","Utilisateur"],{message:p}),isActive:n.O72().default(!0)}),A=n.Ryn({username:n.Z_8().min(3,i).max(50,o).regex(/^[a-z0-9._-]+$/,c).optional(),email:n.Z_8().email(m).max(100,u).optional(),name:n.Z_8().min(1,l).max(100,d).optional(),password:n.Z_8().min(8,a).max(128,s).optional(),role:n.KmV(["Admin","Contr\xf4leur","Utilisateur"],{message:p}).optional(),isActive:n.O72().optional()}),O=n.Ryn({username:n.Z_8().min(1,"Le nom d'utilisateur ou courriel est requis"),password:n.Z_8().min(1,"Le mot de passe est requis")}),w=n.Ryn({numeroOL:n.Z_8().min(1,x).max(50,f).regex(/^[A-Z0-9-]+$/,h),type:n.Z_8().min(1,y).max(200,g),clientId:n.Z_8().uuid(b)});n.Ryn({numeroOL:n.Z_8().min(1,x).max(50,f).regex(/^[A-Z0-9-]+$/,h).optional(),type:n.Z_8().min(1,y).max(200,g).optional(),clientId:n.Z_8().uuid(b).optional()});let I=n.Ryn({companyName:n.Z_8().min(1,N).max(200,v),address:n.Z_8().min(1,L).max(300,Z),province:n.KmV(["QC","ON","AB","BC","MB","NB","NL","NT","NS","NU","PE","SK","YT"],{message:_}),postalCode:n.Z_8().regex(/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,j).transform(e=>e.replace(/[ -]/g,"").toUpperCase())});n.Ryn({companyName:n.Z_8().min(1,N).max(200,v).optional(),address:n.Z_8().min(1,L).max(300,Z).optional(),province:n.KmV(["QC","ON","AB","BC","MB","NB","NL","NT","NS","NU","PE","SK","YT"],{message:_}).optional(),postalCode:n.Z_8().regex(/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,j).transform(e=>e.replace(/[ -]/g,"").toUpperCase()).optional()})}},function(e){e.O(0,[832,971,117,744],function(){return e(e.s=2256)}),_N_E=e.O()}]);